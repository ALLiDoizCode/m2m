<!-- Powered by BMAD™ Core -->

# Story 14.3: Explorer UI Foundation

## Status

Done

## Story

**As a** connector operator,
**I want** a React-based Explorer UI with shadcn/ui components and real-time WebSocket event streaming,
**So that** I can monitor telemetry events flowing through my connector node in a browser interface.

## Acceptance Criteria

1. Vite project initialized in `explorer-ui/` directory
2. shadcn/ui configured with M2M theme (dark mode default)
3. WebSocket hook connects to `/ws` endpoint
4. EventTable component displays streaming events
5. Basic layout with header showing node ID
6. Build produces static bundle in `dist/explorer-ui/`
7. npm script integrates UI build into connector build

## Tasks / Subtasks

- [x] Task 1: Initialize Vite React TypeScript Project (AC: 1)
  - [x] Create directory: `packages/connector/explorer-ui/`
  - [x] Initialize Vite project with React and TypeScript template:
    ```bash
    cd packages/connector/explorer-ui
    npm create vite@latest . -- --template react-ts
    ```
  - [x] Configure `vite.config.ts`:

    ```typescript
    import { defineConfig } from 'vite';
    import react from '@vitejs/plugin-react';
    import path from 'path';

    export default defineConfig({
      plugins: [react()],
      resolve: {
        alias: {
          '@': path.resolve(__dirname, './src'),
        },
      },
      build: {
        outDir: '../dist/explorer-ui',
        emptyOutDir: true,
      },
      server: {
        proxy: {
          '/api': 'http://localhost:3001',
          '/ws': {
            target: 'ws://localhost:3001',
            ws: true,
          },
        },
      },
    });
    ```

  - [x] Update `package.json` with project name and scripts:
    ```json
    {
      "name": "@m2m/explorer-ui",
      "private": true,
      "scripts": {
        "dev": "vite",
        "build": "tsc && vite build",
        "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
        "preview": "vite preview"
      }
    }
    ```
  - [x] Install dependencies:
    ```bash
    npm install
    npm install -D @types/node
    ```
  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 109-114]

- [x] Task 2: Configure Tailwind CSS with shadcn/ui (AC: 2)
  - [x] Install Tailwind CSS and dependencies:
    ```bash
    npm install -D tailwindcss postcss autoprefixer
    npx tailwindcss init -p
    ```
  - [x] Configure `tailwind.config.js` for shadcn/ui:
    ```javascript
    /** @type {import('tailwindcss').Config} */
    module.exports = {
      darkMode: ['class'],
      content: [
        './pages/**/*.{ts,tsx}',
        './components/**/*.{ts,tsx}',
        './app/**/*.{ts,tsx}',
        './src/**/*.{ts,tsx}',
      ],
      theme: {
        container: {
          center: true,
          padding: '2rem',
          screens: {
            '2xl': '1400px',
          },
        },
        extend: {
          colors: {
            border: 'hsl(var(--border))',
            input: 'hsl(var(--input))',
            ring: 'hsl(var(--ring))',
            background: 'hsl(var(--background))',
            foreground: 'hsl(var(--foreground))',
            primary: {
              DEFAULT: 'hsl(var(--primary))',
              foreground: 'hsl(var(--primary-foreground))',
            },
            secondary: {
              DEFAULT: 'hsl(var(--secondary))',
              foreground: 'hsl(var(--secondary-foreground))',
            },
            destructive: {
              DEFAULT: 'hsl(var(--destructive))',
              foreground: 'hsl(var(--destructive-foreground))',
            },
            muted: {
              DEFAULT: 'hsl(var(--muted))',
              foreground: 'hsl(var(--muted-foreground))',
            },
            accent: {
              DEFAULT: 'hsl(var(--accent))',
              foreground: 'hsl(var(--accent-foreground))',
            },
            popover: {
              DEFAULT: 'hsl(var(--popover))',
              foreground: 'hsl(var(--popover-foreground))',
            },
            card: {
              DEFAULT: 'hsl(var(--card))',
              foreground: 'hsl(var(--card-foreground))',
            },
          },
          borderRadius: {
            lg: 'var(--radius)',
            md: 'calc(var(--radius) - 2px)',
            sm: 'calc(var(--radius) - 4px)',
          },
        },
      },
      plugins: [require('tailwindcss-animate')],
    };
    ```
  - [x] Install tailwindcss-animate:
    ```bash
    npm install tailwindcss-animate
    ```
  - [x] Create `src/index.css` with dark mode theme:

    ```css
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    @layer base {
      :root {
        --background: 0 0% 100%;
        --foreground: 222.2 84% 4.9%;
        --card: 0 0% 100%;
        --card-foreground: 222.2 84% 4.9%;
        --popover: 0 0% 100%;
        --popover-foreground: 222.2 84% 4.9%;
        --primary: 222.2 47.4% 11.2%;
        --primary-foreground: 210 40% 98%;
        --secondary: 210 40% 96.1%;
        --secondary-foreground: 222.2 47.4% 11.2%;
        --muted: 210 40% 96.1%;
        --muted-foreground: 215.4 16.3% 46.9%;
        --accent: 210 40% 96.1%;
        --accent-foreground: 222.2 47.4% 11.2%;
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 210 40% 98%;
        --border: 214.3 31.8% 91.4%;
        --input: 214.3 31.8% 91.4%;
        --ring: 222.2 84% 4.9%;
        --radius: 0.5rem;
      }

      .dark {
        --background: 222.2 84% 4.9%;
        --foreground: 210 40% 98%;
        --card: 222.2 84% 4.9%;
        --card-foreground: 210 40% 98%;
        --popover: 222.2 84% 4.9%;
        --popover-foreground: 210 40% 98%;
        --primary: 210 40% 98%;
        --primary-foreground: 222.2 47.4% 11.2%;
        --secondary: 217.2 32.6% 17.5%;
        --secondary-foreground: 210 40% 98%;
        --muted: 217.2 32.6% 17.5%;
        --muted-foreground: 215 20.2% 65.1%;
        --accent: 217.2 32.6% 17.5%;
        --accent-foreground: 210 40% 98%;
        --destructive: 0 62.8% 30.6%;
        --destructive-foreground: 210 40% 98%;
        --border: 217.2 32.6% 17.5%;
        --input: 217.2 32.6% 17.5%;
        --ring: 212.7 26.8% 83.9%;
      }
    }

    @layer base {
      * {
        @apply border-border;
      }
      body {
        @apply bg-background text-foreground;
      }
    }
    ```

  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md line 113, shadcn/ui documentation]

- [x] Task 3: Install shadcn/ui Base Components (AC: 2)
  - [x] Initialize shadcn/ui CLI:

    ```bash
    npx shadcn@latest init
    ```

    - Style: Default
    - Base color: Slate
    - CSS variables: Yes

  - [x] Install required base components:
    ```bash
    npx shadcn@latest add button
    npx shadcn@latest add table
    npx shadcn@latest add badge
    npx shadcn@latest add card
    npx shadcn@latest add scroll-area
    ```
  - [x] Create `src/lib/utils.ts` for cn helper:

    ```typescript
    import { type ClassValue, clsx } from 'clsx';
    import { twMerge } from 'tailwind-merge';

    export function cn(...inputs: ClassValue[]) {
      return twMerge(clsx(inputs));
    }
    ```

  - [x] Install clsx and tailwind-merge:
    ```bash
    npm install clsx tailwind-merge
    ```
  - [x] [Source: CLAUDE.md lines 53-80, shadcn/ui v4 documentation]

- [x] Task 4: Create Telemetry Event Types for Frontend (AC: 3, 4)
  - [x] Create file: `packages/connector/explorer-ui/src/lib/event-types.ts`
  - [x] Define frontend-compatible event types (subset of backend types):

    ```typescript
    /**
     * Telemetry event types for Explorer UI
     *
     * Mirrors key types from @m2m/shared for frontend use
     */

    /**
     * Complete enumeration of all telemetry event types.
     * Mirrors TelemetryEventType enum from @m2m/shared.
     */
    export type TelemetryEventType =
      // Node lifecycle events
      | 'NODE_STATUS'
      // Packet flow events
      | 'PACKET_RECEIVED'
      | 'PACKET_FORWARDED'
      // Account and settlement events
      | 'ACCOUNT_BALANCE'
      | 'SETTLEMENT_TRIGGERED'
      | 'SETTLEMENT_COMPLETED'
      // Agent wallet events
      | 'AGENT_BALANCE_CHANGED'
      | 'AGENT_WALLET_FUNDED'
      | 'AGENT_WALLET_STATE_CHANGED'
      | 'FUNDING_RATE_LIMIT_EXCEEDED'
      | 'FUNDING_TRANSACTION_CONFIRMED'
      | 'FUNDING_TRANSACTION_FAILED'
      // EVM payment channel events
      | 'PAYMENT_CHANNEL_OPENED'
      | 'PAYMENT_CHANNEL_BALANCE_UPDATE'
      | 'PAYMENT_CHANNEL_SETTLED'
      // XRP payment channel events
      | 'XRP_CHANNEL_OPENED'
      | 'XRP_CHANNEL_CLAIMED'
      | 'XRP_CHANNEL_CLOSED'
      // Agent channel events
      | 'AGENT_CHANNEL_OPENED'
      | 'AGENT_CHANNEL_PAYMENT_SENT'
      | 'AGENT_CHANNEL_CLOSED'
      // Security events
      | 'WALLET_BALANCE_MISMATCH'
      | 'SUSPICIOUS_ACTIVITY_DETECTED'
      | 'RATE_LIMIT_EXCEEDED';

    /**
     * Base telemetry event interface
     */
    export interface TelemetryEvent {
      type: TelemetryEventType;
      nodeId?: string;
      timestamp: string | number;
      peerId?: string;
      [key: string]: unknown;
    }

    /**
     * Stored event from EventStore API
     */
    export interface StoredEvent {
      id: number;
      event_type: string;
      timestamp: number;
      node_id: string;
      direction: string | null;
      peer_id: string | null;
      packet_id: string | null;
      amount: string | null;
      destination: string | null;
      payload: TelemetryEvent;
    }

    /**
     * Response from GET /api/events
     */
    export interface EventsResponse {
      events: StoredEvent[];
      total: number;
      limit: number;
      offset: number;
    }

    /**
     * Response from GET /api/health
     */
    export interface HealthResponse {
      status: 'healthy' | 'degraded';
      nodeId: string;
      uptime: number;
      explorer: {
        eventCount: number;
        databaseSizeBytes: number;
        wsConnections: number;
      };
      timestamp: string;
    }

    /**
     * Event type color mapping for badges.
     * Uses Tailwind CSS color classes (included in default Tailwind palette).
     */
    export const EVENT_TYPE_COLORS: Record<string, string> = {
      // Node lifecycle - gray (neutral)
      NODE_STATUS: 'bg-gray-500',
      // Packet flow - blue shades
      PACKET_RECEIVED: 'bg-blue-400',
      PACKET_FORWARDED: 'bg-blue-600',
      // Account and settlement - green/yellow
      ACCOUNT_BALANCE: 'bg-blue-500',
      SETTLEMENT_TRIGGERED: 'bg-yellow-500',
      SETTLEMENT_COMPLETED: 'bg-green-500',
      // Agent wallet - purple/indigo
      AGENT_BALANCE_CHANGED: 'bg-purple-500',
      AGENT_WALLET_FUNDED: 'bg-indigo-500',
      AGENT_WALLET_STATE_CHANGED: 'bg-cyan-500',
      FUNDING_RATE_LIMIT_EXCEEDED: 'bg-amber-500',
      FUNDING_TRANSACTION_CONFIRMED: 'bg-lime-500',
      FUNDING_TRANSACTION_FAILED: 'bg-rose-500',
      // EVM payment channels - emerald/teal
      PAYMENT_CHANNEL_OPENED: 'bg-emerald-500',
      PAYMENT_CHANNEL_BALANCE_UPDATE: 'bg-teal-500',
      PAYMENT_CHANNEL_SETTLED: 'bg-green-600',
      // XRP channels - orange
      XRP_CHANNEL_OPENED: 'bg-orange-500',
      XRP_CHANNEL_CLAIMED: 'bg-orange-400',
      XRP_CHANNEL_CLOSED: 'bg-orange-600',
      // Agent channels - violet
      AGENT_CHANNEL_OPENED: 'bg-violet-500',
      AGENT_CHANNEL_PAYMENT_SENT: 'bg-violet-400',
      AGENT_CHANNEL_CLOSED: 'bg-violet-600',
      // Security events - red shades
      WALLET_BALANCE_MISMATCH: 'bg-red-500',
      SUSPICIOUS_ACTIVITY_DETECTED: 'bg-red-600',
      RATE_LIMIT_EXCEEDED: 'bg-red-400',
    };

    /**
     * Format relative timestamp (e.g., "2s ago")
     */
    export function formatRelativeTime(timestamp: number): string {
      const now = Date.now();
      const diff = now - timestamp;

      if (diff < 1000) return 'just now';
      if (diff < 60000) return `${Math.floor(diff / 1000)}s ago`;
      if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
      return new Date(timestamp).toLocaleString();
    }
    ```

  - [x] [Source: packages/shared/src/types/telemetry.ts, packages/connector/src/explorer/event-store.ts lines 51-75]

- [x] Task 5: Create useEventStream Hook for WebSocket Connection (AC: 3)
  - [x] Create file: `packages/connector/explorer-ui/src/hooks/useEventStream.ts`
  - [x] Implement WebSocket hook with auto-reconnect:

    ```typescript
    import { useState, useEffect, useCallback, useRef } from 'react';
    import { TelemetryEvent } from '../lib/event-types';

    interface UseEventStreamOptions {
      /** Maximum events to keep in memory */
      maxEvents?: number;
      /** Reconnect delay in milliseconds */
      reconnectDelay?: number;
      /** Maximum reconnect attempts */
      maxReconnectAttempts?: number;
    }

    interface UseEventStreamResult {
      /** Current list of events (newest first) */
      events: TelemetryEvent[];
      /** WebSocket connection status */
      status: 'connecting' | 'connected' | 'disconnected' | 'error';
      /** Error message if status is 'error' */
      error: string | null;
      /** Clear all events */
      clearEvents: () => void;
      /** Manually reconnect */
      reconnect: () => void;
    }

    const DEFAULT_MAX_EVENTS = 1000;
    const DEFAULT_RECONNECT_DELAY = 1000;
    const DEFAULT_MAX_RECONNECT_ATTEMPTS = 10;

    export function useEventStream(options: UseEventStreamOptions = {}): UseEventStreamResult {
      const {
        maxEvents = DEFAULT_MAX_EVENTS,
        reconnectDelay = DEFAULT_RECONNECT_DELAY,
        maxReconnectAttempts = DEFAULT_MAX_RECONNECT_ATTEMPTS,
      } = options;

      const [events, setEvents] = useState<TelemetryEvent[]>([]);
      const [status, setStatus] = useState<'connecting' | 'connected' | 'disconnected' | 'error'>(
        'connecting'
      );
      const [error, setError] = useState<string | null>(null);

      const wsRef = useRef<WebSocket | null>(null);
      const reconnectAttemptsRef = useRef(0);
      const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);

      const connect = useCallback(() => {
        // Clean up existing connection
        if (wsRef.current) {
          wsRef.current.close();
        }

        setStatus('connecting');
        setError(null);

        // Determine WebSocket URL
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const host = window.location.host;
        const wsUrl = `${protocol}//${host}/ws`;

        const ws = new WebSocket(wsUrl);

        ws.onopen = () => {
          setStatus('connected');
          setError(null);
          reconnectAttemptsRef.current = 0;
        };

        ws.onmessage = (event) => {
          try {
            const telemetryEvent = JSON.parse(event.data) as TelemetryEvent;
            setEvents((prev) => {
              const updated = [telemetryEvent, ...prev];
              return updated.slice(0, maxEvents);
            });
          } catch (err) {
            console.error('Failed to parse event:', err);
          }
        };

        ws.onerror = () => {
          setError('WebSocket connection error');
        };

        ws.onclose = () => {
          setStatus('disconnected');
          wsRef.current = null;

          // Auto-reconnect with exponential backoff
          if (reconnectAttemptsRef.current < maxReconnectAttempts) {
            const delay = reconnectDelay * Math.pow(2, reconnectAttemptsRef.current);
            reconnectAttemptsRef.current++;

            reconnectTimeoutRef.current = setTimeout(() => {
              connect();
            }, delay);
          } else {
            setStatus('error');
            setError('Max reconnect attempts reached');
          }
        };

        wsRef.current = ws;
      }, [maxEvents, reconnectDelay, maxReconnectAttempts]);

      const clearEvents = useCallback(() => {
        setEvents([]);
      }, []);

      const reconnect = useCallback(() => {
        reconnectAttemptsRef.current = 0;
        connect();
      }, [connect]);

      // Connect on mount
      useEffect(() => {
        connect();

        return () => {
          if (wsRef.current) {
            wsRef.current.close();
          }
          if (reconnectTimeoutRef.current) {
            clearTimeout(reconnectTimeoutRef.current);
          }
        };
      }, [connect]);

      return { events, status, error, clearEvents, reconnect };
    }
    ```

  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 233-235]

- [x] Task 6: Create EventTable Component (AC: 4)
  - [x] Create file: `packages/connector/explorer-ui/src/components/EventTable.tsx`
  - [x] Implement table using shadcn/ui Table component:

    ```typescript
    import { TelemetryEvent, EVENT_TYPE_COLORS, formatRelativeTime } from '../lib/event-types';
    import { Badge } from '@/components/ui/badge';
    import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
    import { ScrollArea } from '@/components/ui/scroll-area';

    interface EventTableProps {
      events: TelemetryEvent[];
      onEventClick?: (event: TelemetryEvent) => void;
    }

    /**
     * Extract direction from event
     */
    function getDirection(event: TelemetryEvent): string {
      if ('direction' in event && event.direction) {
        return event.direction as string;
      }
      if (event.type === 'AGENT_CHANNEL_PAYMENT_SENT') {
        return 'sent';
      }
      return '-';
    }

    /**
     * Get direction display with icon
     */
    function getDirectionDisplay(direction: string): string {
      switch (direction) {
        case 'sent':
          return '→ Sent';
        case 'received':
          return '← Received';
        case 'internal':
          return '⟳ Internal';
        default:
          return '-';
      }
    }

    /**
     * Extract amount from event
     */
    function getAmount(event: TelemetryEvent): string | null {
      const amountFields = ['amount', 'settledAmount', 'netBalance', 'change', 'claimAmount', 'finalBalance'];
      for (const field of amountFields) {
        if (field in event && event[field]) {
          return event[field] as string;
        }
      }
      return null;
    }

    /**
     * Format amount for display (truncate large numbers)
     */
    function formatAmount(amount: string): string {
      const num = BigInt(amount);
      if (num > BigInt(1e18)) {
        return `${(Number(num) / 1e18).toFixed(4)} ETH`;
      }
      if (num > BigInt(1e12)) {
        return `${(Number(num) / 1e12).toFixed(2)}T`;
      }
      if (num > BigInt(1e9)) {
        return `${(Number(num) / 1e9).toFixed(2)}B`;
      }
      if (num > BigInt(1e6)) {
        return `${(Number(num) / 1e6).toFixed(2)}M`;
      }
      if (num > BigInt(1e3)) {
        return `${(Number(num) / 1e3).toFixed(2)}K`;
      }
      return amount;
    }

    /**
     * Normalize timestamp to number
     */
    function normalizeTimestamp(ts: string | number): number {
      if (typeof ts === 'number') return ts;
      return new Date(ts).getTime();
    }

    export function EventTable({ events, onEventClick }: EventTableProps) {
      return (
        <ScrollArea className="h-[calc(100vh-200px)]">
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead className="w-[100px]">Time</TableHead>
                <TableHead className="w-[200px]">Type</TableHead>
                <TableHead className="w-[100px]">Direction</TableHead>
                <TableHead className="w-[150px]">Peer</TableHead>
                <TableHead className="w-[150px]">Amount</TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {events.length === 0 ? (
                <TableRow>
                  <TableCell colSpan={5} className="text-center text-muted-foreground py-8">
                    Waiting for events...
                  </TableCell>
                </TableRow>
              ) : (
                events.map((event, index) => {
                  const direction = getDirection(event);
                  const amount = getAmount(event);
                  const timestamp = normalizeTimestamp(event.timestamp);

                  return (
                    <TableRow
                      key={`${timestamp}-${index}`}
                      className="cursor-pointer hover:bg-muted/50"
                      onClick={() => onEventClick?.(event)}
                    >
                      <TableCell className="font-mono text-sm text-muted-foreground">
                        {formatRelativeTime(timestamp)}
                      </TableCell>
                      <TableCell>
                        <Badge
                          variant="secondary"
                          className={`${EVENT_TYPE_COLORS[event.type] || 'bg-gray-500'} text-white`}
                        >
                          {event.type.replace(/_/g, ' ')}
                        </Badge>
                      </TableCell>
                      <TableCell className="text-sm">
                        {getDirectionDisplay(direction)}
                      </TableCell>
                      <TableCell className="font-mono text-sm">
                        {event.peerId || '-'}
                      </TableCell>
                      <TableCell className="font-mono text-sm">
                        {amount ? formatAmount(amount) : '-'}
                      </TableCell>
                    </TableRow>
                  );
                })
              )}
            </TableBody>
          </Table>
        </ScrollArea>
      );
    }
    ```

  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 77-87, shadcn/ui Table component]

- [x] Task 7: Create Header Component with Node ID (AC: 5)
  - [x] Create file: `packages/connector/explorer-ui/src/components/Header.tsx`
  - [x] Implement header with node status:

    ```typescript
    import { useEffect, useState } from 'react';
    import { Badge } from '@/components/ui/badge';
    import { HealthResponse } from '../lib/event-types';

    interface HeaderProps {
      status: 'connecting' | 'connected' | 'disconnected' | 'error';
      eventCount: number;
    }

    export function Header({ status, eventCount }: HeaderProps) {
      const [health, setHealth] = useState<HealthResponse | null>(null);

      useEffect(() => {
        const fetchHealth = async () => {
          try {
            const response = await fetch('/api/health');
            if (response.ok) {
              const data = await response.json();
              setHealth(data);
            }
          } catch (err) {
            console.error('Failed to fetch health:', err);
          }
        };

        fetchHealth();
        const interval = setInterval(fetchHealth, 30000); // Refresh every 30s

        return () => clearInterval(interval);
      }, []);

      const getStatusColor = () => {
        switch (status) {
          case 'connected':
            return 'bg-green-500';
          case 'connecting':
            return 'bg-yellow-500';
          case 'disconnected':
            return 'bg-gray-500';
          case 'error':
            return 'bg-red-500';
          default:
            return 'bg-gray-500';
        }
      };

      return (
        <header className="border-b border-border px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <h1 className="text-xl font-bold">M2M Explorer</h1>
              {health && (
                <span className="text-sm text-muted-foreground">
                  Node: <span className="font-mono">{health.nodeId}</span>
                </span>
              )}
            </div>
            <div className="flex items-center gap-4">
              <Badge variant="outline" className="font-mono">
                {eventCount} events
              </Badge>
              <div className="flex items-center gap-2">
                <div className={`w-2 h-2 rounded-full ${getStatusColor()}`} />
                <span className="text-sm text-muted-foreground capitalize">{status}</span>
              </div>
            </div>
          </div>
        </header>
      );
    }
    ```

  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md line 228]

- [x] Task 8: Create Main App Component (AC: 2, 3, 4, 5)
  - [x] Update `packages/connector/explorer-ui/src/App.tsx`:

    ```typescript
    import { useEventStream } from './hooks/useEventStream';
    import { EventTable } from './components/EventTable';
    import { Header } from './components/Header';
    import { TelemetryEvent } from './lib/event-types';

    function App() {
      const { events, status, error, clearEvents } = useEventStream({
        maxEvents: 1000,
      });

      const handleEventClick = (event: TelemetryEvent) => {
        // Will be implemented in Story 14.5 (Event Detail Panel)
        console.log('Event clicked:', event);
      };

      return (
        <div className="min-h-screen bg-background text-foreground dark">
          <Header status={status} eventCount={events.length} />
          <main className="p-6">
            {error && (
              <div className="mb-4 p-4 border border-destructive rounded-md bg-destructive/10 text-destructive">
                {error}
              </div>
            )}
            <EventTable events={events} onEventClick={handleEventClick} />
          </main>
        </div>
      );
    }

    export default App;
    ```

  - [x] Update `packages/connector/explorer-ui/src/main.tsx`:

    ```typescript
    import React from 'react'
    import ReactDOM from 'react-dom/client'
    import App from './App.tsx'
    import './index.css'

    ReactDOM.createRoot(document.getElementById('root')!).render(
      <React.StrictMode>
        <App />
      </React.StrictMode>,
    )
    ```

  - [x] Update `packages/connector/explorer-ui/index.html`:
    ```html
    <!DOCTYPE html>
    <html lang="en" class="dark">
      <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/svg+xml" href="/vite.svg" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>M2M Explorer</title>
      </head>
      <body>
        <div id="root"></div>
        <script type="module" src="/src/main.tsx"></script>
      </body>
    </html>
    ```
  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 139-146]

- [x] Task 9: Configure Build Output Path (AC: 6)
  - [x] Verify `vite.config.ts` build output:
    ```typescript
    build: {
      outDir: '../dist/explorer-ui',
      emptyOutDir: true,
    },
    ```
  - [x] Run build to verify output:
    ```bash
    cd packages/connector/explorer-ui
    npm run build
    ```
  - [x] Verify files created in `packages/connector/dist/explorer-ui/`:
    - `index.html`
    - `assets/` (JS and CSS bundles)
  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 154-156]

- [x] Task 10: Integrate UI Build into Connector Build Scripts (AC: 7)
  - [x] Update `packages/connector/package.json` scripts:
    ```json
    {
      "scripts": {
        "build": "npm run build:ui && tsc",
        "build:ui": "cd explorer-ui && npm install && npm run build",
        "build:connector-only": "tsc",
        "dev:ui": "cd explorer-ui && npm run dev"
      }
    }
    ```
  - [x] **Note**: explorer-ui is NOT a monorepo workspace. It is a standalone nested package within connector that manages its own dependencies. This avoids hoisting issues with Vite/React dependencies and keeps the UI build isolated.
  - [x] Install explorer-ui dependencies locally:
    ```bash
    cd packages/connector/explorer-ui
    npm install
    ```
  - [x] Test full build from connector package:
    ```bash
    cd packages/connector
    npm run build
    ```
  - [x] Verify both TypeScript and UI builds complete successfully
  - [x] **Build Failure Handling**: If explorer-ui build fails, `build:connector-only` can be used to build just the connector TypeScript without the UI. This allows connector operation without the explorer feature.
  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md line 228]

- [x] Task 11: Add TypeScript Path Aliases (AC: 1, 2)
  - [x] Create `packages/connector/explorer-ui/tsconfig.json`:
    ```json
    {
      "compilerOptions": {
        "target": "ES2020",
        "useDefineForClassFields": true,
        "lib": ["ES2020", "DOM", "DOM.Iterable"],
        "module": "ESNext",
        "skipLibCheck": true,
        "moduleResolution": "bundler",
        "allowImportingTsExtensions": true,
        "resolveJsonModule": true,
        "isolatedModules": true,
        "noEmit": true,
        "jsx": "react-jsx",
        "strict": true,
        "noUnusedLocals": true,
        "noUnusedParameters": true,
        "noFallthroughCasesInSwitch": true,
        "baseUrl": ".",
        "paths": {
          "@/*": ["./src/*"]
        }
      },
      "include": ["src"],
      "references": [{ "path": "./tsconfig.node.json" }]
    }
    ```
  - [x] Create `packages/connector/explorer-ui/tsconfig.node.json`:
    ```json
    {
      "compilerOptions": {
        "composite": true,
        "skipLibCheck": true,
        "module": "ESNext",
        "moduleResolution": "bundler",
        "allowSyntheticDefaultImports": true,
        "strict": true
      },
      "include": ["vite.config.ts"]
    }
    ```
  - [x] [Source: docs/architecture/coding-standards.md lines 36-41, Vite TypeScript documentation]

- [x] Task 12: Create Unit Tests for useEventStream Hook (AC: 3)
  - [x] Install testing dependencies:
    ```bash
    cd packages/connector/explorer-ui
    npm install -D vitest @testing-library/react @testing-library/jest-dom jsdom
    ```
  - [x] Add Vitest configuration to `vite.config.ts`:

    ```typescript
    /// <reference types="vitest" />
    import { defineConfig } from 'vite';
    import react from '@vitejs/plugin-react';
    import path from 'path';

    export default defineConfig({
      plugins: [react()],
      resolve: {
        alias: {
          '@': path.resolve(__dirname, './src'),
        },
      },
      build: {
        outDir: '../dist/explorer-ui',
        emptyOutDir: true,
      },
      server: {
        proxy: {
          '/api': 'http://localhost:3001',
          '/ws': {
            target: 'ws://localhost:3001',
            ws: true,
          },
        },
      },
      test: {
        globals: true,
        environment: 'jsdom',
        setupFiles: './src/test/setup.ts',
      },
    });
    ```

  - [x] Create `packages/connector/explorer-ui/src/test/setup.ts`:
    ```typescript
    import '@testing-library/jest-dom';
    ```
  - [x] Create `packages/connector/explorer-ui/src/hooks/useEventStream.test.ts`:

    ```typescript
    import { describe, it, expect, vi, beforeEach, afterEach } from 'vitest';
    import { renderHook, act, waitFor } from '@testing-library/react';
    import { useEventStream } from './useEventStream';

    class MockWebSocket {
      static instances: MockWebSocket[] = [];

      url: string;
      onopen: ((event: Event) => void) | null = null;
      onmessage: ((event: MessageEvent) => void) | null = null;
      onerror: ((event: Event) => void) | null = null;
      onclose: ((event: CloseEvent) => void) | null = null;
      readyState = WebSocket.CONNECTING;

      constructor(url: string) {
        this.url = url;
        MockWebSocket.instances.push(this);
      }

      close() {
        this.readyState = WebSocket.CLOSED;
        if (this.onclose) {
          this.onclose(new CloseEvent('close'));
        }
      }

      send(_data: string) {}

      // Helper to simulate connection
      simulateOpen() {
        this.readyState = WebSocket.OPEN;
        if (this.onopen) {
          this.onopen(new Event('open'));
        }
      }

      // Helper to simulate message
      simulateMessage(data: object) {
        if (this.onmessage) {
          this.onmessage(new MessageEvent('message', { data: JSON.stringify(data) }));
        }
      }
    }

    describe('useEventStream', () => {
      beforeEach(() => {
        MockWebSocket.instances = [];
        vi.stubGlobal('WebSocket', MockWebSocket);
      });

      afterEach(() => {
        vi.unstubAllGlobals();
      });

      it('should start with connecting status', () => {
        const { result } = renderHook(() => useEventStream());
        expect(result.current.status).toBe('connecting');
      });

      it('should connect to WebSocket and update status', async () => {
        const { result } = renderHook(() => useEventStream());

        await act(async () => {
          MockWebSocket.instances[0]?.simulateOpen();
        });

        expect(result.current.status).toBe('connected');
      });

      it('should receive and store events', async () => {
        const { result } = renderHook(() => useEventStream());

        await act(async () => {
          MockWebSocket.instances[0]?.simulateOpen();
          MockWebSocket.instances[0]?.simulateMessage({
            type: 'ACCOUNT_BALANCE',
            nodeId: 'test-node',
            timestamp: Date.now(),
          });
        });

        expect(result.current.events).toHaveLength(1);
        expect(result.current.events[0]?.type).toBe('ACCOUNT_BALANCE');
      });

      it('should limit events to maxEvents', async () => {
        const { result } = renderHook(() => useEventStream({ maxEvents: 5 }));

        await act(async () => {
          MockWebSocket.instances[0]?.simulateOpen();
          for (let i = 0; i < 10; i++) {
            MockWebSocket.instances[0]?.simulateMessage({
              type: 'ACCOUNT_BALANCE',
              nodeId: 'test-node',
              timestamp: Date.now() + i,
            });
          }
        });

        expect(result.current.events).toHaveLength(5);
      });

      it('should clear events when clearEvents is called', async () => {
        const { result } = renderHook(() => useEventStream());

        await act(async () => {
          MockWebSocket.instances[0]?.simulateOpen();
          MockWebSocket.instances[0]?.simulateMessage({
            type: 'ACCOUNT_BALANCE',
            nodeId: 'test-node',
            timestamp: Date.now(),
          });
        });

        expect(result.current.events).toHaveLength(1);

        act(() => {
          result.current.clearEvents();
        });

        expect(result.current.events).toHaveLength(0);
      });
    });
    ```

  - [x] Add test script to `package.json`:
    ```json
    {
      "scripts": {
        "test": "vitest run",
        "test:watch": "vitest"
      }
    }
    ```
  - [x] [Source: Vitest documentation, React Testing Library, Vite ecosystem standards]
  - [x] **Note**: This uses Vitest (not Jest) - see Technical Context section for rationale

- [x] Task 13: Verify End-to-End Integration (AC: 1-7)
  - [x] Start ExplorerServer on port 3001:
    ```bash
    # Ensure connector is running with explorer enabled
    cd packages/connector
    npm run build
    npm start
    ```
  - [x] Start Vite dev server:
    ```bash
    cd packages/connector/explorer-ui
    npm run dev
    ```
  - [x] Open browser to http://localhost:5173
  - [x] Verify:
    - [x] Dark theme applied correctly
    - [x] Header shows "M2M Explorer" with node ID
    - [x] WebSocket status shows "connected"
    - [x] Event table displays with "Waiting for events..."
  - [x] **Generate test events** to verify streaming:
    - [x] Option A: Use send-packet tool to trigger packet flow events:
      ```bash
      npm run send-packet -- --destination g.test --amount 1000
      ```
    - [x] Option B: Start multi-node Docker topology to generate activity:
      ```bash
      docker-compose -f docker/docker-compose.yml up -d
      ```
    - [x] Option C: Emit test event via TelemetryEmitter in connector code (for development):
      ```typescript
      // In connector startup or test script
      telemetryEmitter.emit({
        type: 'ACCOUNT_BALANCE',
        nodeId: 'test-node',
        peerId: 'peer-test',
        tokenId: 'ILP',
        debitBalance: '0',
        creditBalance: '1000',
        netBalance: '-1000',
        settlementState: 'IDLE',
        timestamp: new Date().toISOString(),
      });
      ```
  - [x] Verify events appear in table with:
    - [x] Color-coded badges by event type
    - [x] Relative timestamps ("2s ago")
    - [x] Peer ID and amount columns populated
  - [x] Test production build:
    ```bash
    cd packages/connector/explorer-ui
    npm run build
    ```
  - [x] Verify static files served by ExplorerServer at http://localhost:3001
  - [x] [Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 160-169]

- [x] Task 14: Playwright MCP Browser Verification (AC: 2, 4, 5)
  - [x] Start the Explorer UI dev server and connector backend
  - [x] Use `mcp__playwright__browser_navigate` to open http://localhost:5173
  - [x] Use `mcp__playwright__browser_snapshot` to capture accessibility snapshot and verify:
    - [x] Dark theme applied (background color, text contrast)
    - [x] Header displays "M2M Explorer" title
    - [x] WebSocket status indicator visible
    - [x] EventTable structure with correct columns (Time, Type, Direction, Peer, Amount)
  - [x] Use `mcp__playwright__browser_take_screenshot` to capture visual state for documentation
  - [x] Verify shadcn/ui components render correctly:
    - [x] Badge components with color-coded event types
    - [x] Table component with proper styling
    - [x] ScrollArea component functioning
  - [x] [Source: CLAUDE.md lines 11, 129-146 - Playwright MCP verification requirements]

## Dev Notes

### Previous Story Insights

Story 14.2 (Explorer Server Infrastructure) completed the backend infrastructure with:

- **ExplorerServer class** serving static files from `dist/explorer-ui/`
- **WebSocket endpoint** at `/ws` for real-time event streaming
- **REST API** at `/api/events` for historical queries and `/api/health` for node status
- **EventBroadcaster** subscribing to TelemetryEmitter for live event broadcast
- **CORS configured** for localhost development (includes port 5173 for Vite)

The Explorer UI needs to:

1. Connect to `/ws` WebSocket endpoint for live event streaming
2. Use `/api/health` to display node ID in header
3. Build to `dist/explorer-ui/` so ExplorerServer can serve the bundle

[Source: docs/stories/14.2.story.md, packages/connector/src/explorer/explorer-server.ts]

### Technical Context

**Frontend Stack Decisions:**

- **React 18.3.x** - Chosen for component-based UI with hooks
- **Vite 5.x** - Fast HMR for development, optimized production builds
- **shadcn/ui v4** - Radix + Tailwind, consistent with project CLAUDE.md requirements
- **TypeScript 5.3.x** - Type safety aligned with backend
- **Vitest** - Test framework for Vite projects (deviation from Jest)

**Testing Framework Deviation:**
The explorer-ui package uses **Vitest** instead of Jest (the project standard per test-strategy-and-standards.md). This deviation is intentional because:

1. Vitest is the native test framework for Vite, providing first-class integration
2. Vitest shares the same config as Vite (vite.config.ts), eliminating duplicate configuration
3. Vitest uses the same transformation pipeline as Vite, ensuring consistent behavior
4. The React Testing Library API is identical between Jest and Vitest

This deviation is scoped to the explorer-ui frontend package only. All backend connector code continues to use Jest.

[Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 109-114, Vite ecosystem best practices]

**Package Structure:**

```
packages/connector/
├── explorer-ui/                   # Frontend source (NEW)
│   ├── src/
│   │   ├── App.tsx               # Main application component
│   │   ├── main.tsx              # React entry point
│   │   ├── index.css             # Tailwind + shadcn theme
│   │   ├── components/
│   │   │   ├── EventTable.tsx    # Event streaming table
│   │   │   ├── Header.tsx        # Header with node ID
│   │   │   └── ui/               # shadcn/ui components
│   │   ├── hooks/
│   │   │   ├── useEventStream.ts # WebSocket connection hook
│   │   │   └── useEventStream.test.ts
│   │   └── lib/
│   │       ├── event-types.ts    # Frontend telemetry types
│   │       └── utils.ts          # shadcn cn() helper
│   ├── index.html
│   ├── vite.config.ts
│   ├── tailwind.config.js
│   ├── tsconfig.json
│   └── package.json
└── dist/
    └── explorer-ui/               # Built frontend (served by Express)
```

[Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 125-156]

### Data Models

**TelemetryEvent (from packages/shared):**
Events streamed via WebSocket are the same types defined in `packages/shared/src/types/telemetry.ts`. The frontend uses a simplified subset.
[Source: packages/shared/src/types/telemetry.ts lines 1046-1067]

**StoredEvent (from EventStore):**

```typescript
interface StoredEvent {
  id: number;
  event_type: string;
  timestamp: number;
  node_id: string;
  direction: string | null;
  peer_id: string | null;
  packet_id: string | null;
  amount: string | null;
  destination: string | null;
  payload: TelemetryEvent;
}
```

[Source: packages/connector/src/explorer/event-store.ts lines 51-75]

### WebSocket Connection Strategy

**Auto-reconnect with exponential backoff:**

- Initial delay: 1000ms
- Exponential factor: 2x
- Max attempts: 10
- Resets on successful connection

**WebSocket URL determination:**

```typescript
const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
const host = window.location.host;
const wsUrl = `${protocol}//${host}/ws`;
```

This allows:

- Development: Vite proxy to `ws://localhost:3001/ws`
- Production: Same-origin WebSocket connection

[Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 233-235]

### File Locations

**New Files:**

```
packages/connector/explorer-ui/              # New directory
├── src/
│   ├── App.tsx
│   ├── main.tsx
│   ├── index.css
│   ├── components/
│   │   ├── EventTable.tsx
│   │   ├── Header.tsx
│   │   └── ui/                             # shadcn components installed here
│   ├── hooks/
│   │   ├── useEventStream.ts
│   │   └── useEventStream.test.ts
│   ├── lib/
│   │   ├── event-types.ts
│   │   └── utils.ts
│   └── test/
│       └── setup.ts
├── index.html
├── package.json
├── vite.config.ts
├── tailwind.config.js
├── postcss.config.js
├── tsconfig.json
├── tsconfig.node.json
└── components.json                          # shadcn/ui config
```

**Modified Files:**

```
packages/connector/package.json              # Add build:ui script
docs/architecture/source-tree.md             # Update after implementation to include explorer-ui structure
```

**Note:** The root `package.json` workspaces configuration is NOT modified. The explorer-ui package is a standalone nested package, not a monorepo workspace.

[Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 125-156]

### Testing Requirements

**Test Framework:** Vitest (aligned with Vite ecosystem)
[Source: Vite documentation, React testing best practices]

**Test Location:** Co-located at `explorer-ui/src/hooks/useEventStream.test.ts`
[Source: docs/architecture/test-strategy-and-standards.md line 22]

**Test Commands:**

```bash
# Run tests
cd packages/connector/explorer-ui
npm test

# Run tests in watch mode
npm run test:watch
```

### Technical Constraints

**shadcn/ui Installation:**

- Use `npx shadcn@latest init` for v4 setup
- Components installed to `src/components/ui/`
- Uses CSS variables for theming
- Dark mode via `class` strategy on `<html>`
  [Source: CLAUDE.md lines 53-80]

**TypeScript Configuration:**

- Strict mode enabled (aligned with project standards)
- Path aliases: `@/*` → `./src/*`
- Module: ESNext for Vite compatibility
  [Source: docs/architecture/coding-standards.md lines 36-41]

**Vite Build Configuration:**

- Output to `../dist/explorer-ui` (relative to explorer-ui directory)
- emptyOutDir: true to clean before build
- Proxy `/api` and `/ws` to port 3001 for development
  [Source: Vite documentation]

### Dependencies

**New Dependencies (explorer-ui/package.json):**

Production:

- `react` - 18.3.x
- `react-dom` - 18.3.x
- `clsx` - className utility
- `tailwind-merge` - Tailwind class merging
- `tailwindcss-animate` - Animation utilities for shadcn

Development:

- `vite` - 5.x
- `@vitejs/plugin-react` - React plugin
- `typescript` - 5.3.x
- `@types/react` - React types
- `@types/react-dom` - ReactDOM types
- `@types/node` - Node.js types
- `tailwindcss` - 3.4.x
- `postcss` - PostCSS processor
- `autoprefixer` - CSS vendor prefixes
- `vitest` - Test runner
- `@testing-library/react` - React testing utilities
- `@testing-library/jest-dom` - Jest DOM matchers
- `jsdom` - DOM implementation for tests

[Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 109-114]

### Edge Cases and Error Scenarios

**WebSocket Connection:**

- WebSocket server unavailable → Show "connecting" status, auto-reconnect
- WebSocket connection dropped → Show "disconnected", attempt reconnect
- Max reconnect attempts exceeded → Show "error" with message, manual reconnect button

**Health API:**

- `/api/health` unavailable → Header shows "M2M Explorer" without node ID
- Network error → Silently fail, retry on next interval

**Event Parsing:**

- Malformed JSON from WebSocket → Log error, ignore message
- Unknown event type → Display with gray badge, still show in table

### Performance Considerations

**Event Limiting:**

- Default maxEvents: 1000 in memory
- Newest events first (prepend to array)
- Older events automatically dropped when limit exceeded

**Re-render Optimization:**

- Events stored in state, React handles reconciliation
- Table uses `key` based on timestamp + index
- Consider virtualization for Story 14.4 (large event counts)

[Source: docs/prd/epic-14-packet-event-explorer-ui.md lines 165, 259]

## Testing

### Test File Locations

- `packages/connector/explorer-ui/src/hooks/useEventStream.test.ts` - WebSocket hook tests

[Source: docs/architecture/test-strategy-and-standards.md line 22]

### Test Framework

Vitest with React Testing Library
[Source: Vite ecosystem best practices]

### Test Commands

```bash
# Run unit tests
cd packages/connector/explorer-ui && npm test

# Run tests in watch mode
cd packages/connector/explorer-ui && npm run test:watch

# Build and serve production bundle
cd packages/connector/explorer-ui && npm run build
cd packages/connector && npm start
# Open http://localhost:3001
```

### Acceptance Criteria Verification

| AC# | Test Scenario                              | Verification Method                                                       |
| --- | ------------------------------------------ | ------------------------------------------------------------------------- |
| 1   | Vite project initialized in explorer-ui/   | Verify directory exists with package.json, vite.config.ts                 |
| 2   | shadcn/ui configured with dark mode        | Verify components.json exists, index.css has dark theme, App renders dark |
| 3   | WebSocket hook connects to /ws             | useEventStream.test.ts tests connection and event receipt                 |
| 4   | EventTable displays streaming events       | Manual verification - events appear in table when emitted                 |
| 5   | Header shows node ID                       | Manual verification - header displays node ID from /api/health            |
| 6   | Build produces dist/explorer-ui/           | Run npm run build, verify index.html and assets in dist/explorer-ui/      |
| 7   | npm script integrates with connector build | Run npm run build from packages/connector, verify both builds complete    |

---

## Change Log

| Date       | Version | Description                                                                                       | Author |
| ---------- | ------- | ------------------------------------------------------------------------------------------------- | ------ |
| 2026-01-24 | 0.1     | Initial story draft creation                                                                      | SM     |
| 2026-01-24 | 0.2     | Validation fixes: workspace config, complete event types, Vitest rationale, test event generation | QA     |

---

## Story Wrap Up (Agent Populates After Execution)

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Completion Notes

- Implemented full Explorer UI with Vite, React, TypeScript, and shadcn/ui v4
- Used Tailwind CSS v3 for styling (v4 was initially installed but downgraded for compatibility with shadcn/ui config format)
- All 5 useEventStream hook tests pass with Vitest
- Build produces static bundle in `dist/explorer-ui/` (index.html, CSS, JS)
- Connector build script integrates UI build via `npm run build:ui`
- explorer-ui is a standalone nested package (not a monorepo workspace)

### File List

**New Files:**

- `packages/connector/explorer-ui/package.json` - Explorer UI package config
- `packages/connector/explorer-ui/package-lock.json` - Dependencies lock file
- `packages/connector/explorer-ui/vite.config.ts` - Vite configuration with Vitest
- `packages/connector/explorer-ui/tsconfig.json` - TypeScript configuration
- `packages/connector/explorer-ui/tsconfig.node.json` - TypeScript node config
- `packages/connector/explorer-ui/tailwind.config.js` - Tailwind CSS config for shadcn/ui
- `packages/connector/explorer-ui/postcss.config.js` - PostCSS config
- `packages/connector/explorer-ui/index.html` - HTML entry point
- `packages/connector/explorer-ui/public/vite.svg` - Vite favicon
- `packages/connector/explorer-ui/src/main.tsx` - React entry point
- `packages/connector/explorer-ui/src/App.tsx` - Main App component
- `packages/connector/explorer-ui/src/index.css` - Tailwind CSS with dark theme
- `packages/connector/explorer-ui/src/vite-env.d.ts` - Vite types
- `packages/connector/explorer-ui/src/lib/utils.ts` - shadcn/ui cn() helper
- `packages/connector/explorer-ui/src/lib/event-types.ts` - Telemetry event types
- `packages/connector/explorer-ui/src/hooks/useEventStream.ts` - WebSocket hook
- `packages/connector/explorer-ui/src/hooks/useEventStream.test.ts` - Hook tests
- `packages/connector/explorer-ui/src/components/EventTable.tsx` - Event table component
- `packages/connector/explorer-ui/src/components/Header.tsx` - Header component
- `packages/connector/explorer-ui/src/components/ui/button.tsx` - shadcn/ui Button
- `packages/connector/explorer-ui/src/components/ui/table.tsx` - shadcn/ui Table
- `packages/connector/explorer-ui/src/components/ui/badge.tsx` - shadcn/ui Badge
- `packages/connector/explorer-ui/src/components/ui/card.tsx` - shadcn/ui Card
- `packages/connector/explorer-ui/src/components/ui/scroll-area.tsx` - shadcn/ui ScrollArea
- `packages/connector/explorer-ui/src/test/setup.ts` - Vitest setup

**Modified Files:**

- `packages/connector/package.json` - Added build:ui, build:connector-only, dev:ui scripts

**Documentation:**

- `.playwright-mcp/explorer-ui-foundation.png` - Playwright screenshot of Explorer UI

### Change Log

| Date       | Version | Description                                  | Author |
| ---------- | ------- | -------------------------------------------- | ------ |
| 2026-01-24 | 0.1     | Initial story draft creation                 | SM     |
| 2026-01-24 | 1.0     | Implementation complete                      | Dev    |
| 2026-01-25 | 1.1     | Playwright MCP browser verification complete | Dev    |

## QA Results

### Review Date: 2026-01-24

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The Explorer UI implementation is well-structured and follows React best practices with proper component separation, TypeScript typing, and shadcn/ui integration. The code demonstrates good architecture with:

- **Clean component hierarchy**: App → Header/EventTable with clear separation of concerns
- **Robust WebSocket handling**: useEventStream hook with exponential backoff reconnection
- **Type safety**: Strong TypeScript types for telemetry events matching backend definitions
- **shadcn/ui v4 integration**: Proper use of Table, Badge, ScrollArea, and Card components

**Minor observations (non-blocking):**

- `console.log` used in App.tsx line 13 for event click handler (placeholder for Story 14.5) - acceptable as documented future work
- `console.error` used appropriately for error logging in header health fetch and WebSocket parse failures

### Refactoring Performed

No refactoring performed - implementation is clean and follows established patterns.

### Compliance Check

- Coding Standards: ✓ TypeScript strict mode enabled, proper naming conventions followed
- Project Structure: ✓ Files organized per story specification with components/, hooks/, lib/ structure
- Testing Strategy: ✓ Vitest used appropriately for Vite ecosystem (deviation documented in story)
- All ACs Met: ✓ All 7 acceptance criteria verified

### Improvements Checklist

- [x] All core components implemented per specification
- [x] WebSocket hook with auto-reconnect and exponential backoff
- [x] Dark mode theme configured as default
- [x] Build produces static bundle in correct location
- [x] Connector build integration working
- [x] Unit tests passing (5/5)
- [ ] Consider adding component tests for EventTable rendering (future enhancement)
- [ ] Consider adding reconnect button UI when max attempts reached (future enhancement)

### Security Review

- **WebSocket URL construction**: Uses same-origin pattern with protocol detection - PASS
- **No credential handling**: UI only reads/displays events - PASS
- **XSS considerations**: React's JSX escapes event data by default - PASS
- **No sensitive data exposure**: Event types are read-only telemetry - PASS

### Performance Considerations

- **Event limiting**: maxEvents=1000 prevents memory growth - PASS
- **Array prepending**: Events added to front, old events dropped - efficient for streaming
- **Scroll virtualization**: Not implemented but noted for Story 14.4 with large event counts
- **Build size**: 199KB JS (63KB gzipped), 17KB CSS - acceptable for dashboard application

### Files Modified During Review

None - no modifications required.

### Gate Status

Gate: PASS → docs/qa/gates/14.3-explorer-ui-foundation.yml

### Recommended Status

✓ Ready for Done

All acceptance criteria verified:

1. ✓ Vite project initialized in explorer-ui/ with proper configuration
2. ✓ shadcn/ui configured with M2M dark mode theme
3. ✓ WebSocket hook connects to /ws with auto-reconnect
4. ✓ EventTable displays streaming events with color-coded badges
5. ✓ Header shows node ID from /api/health endpoint
6. ✓ Build produces static bundle in dist/explorer-ui/
7. ✓ npm scripts integrate UI build into connector build

---

### Review Date: 2026-01-25

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Re-reviewed implementation following continued development. The Explorer UI has matured significantly with additional features from Stories 14.4 (filtering) and 14.5 (detail panel) now integrated. Core Story 14.3 functionality remains solid:

- **Architecture:** Clean component hierarchy with App → Header/FilterBar/EventTable/EventDetailPanel
- **Type Safety:** Strong TypeScript typing throughout with proper interfaces
- **Performance:** Virtual scrolling via @tanstack/react-virtual, memoized row components
- **WebSocket Handling:** Robust useEventStream hook with exponential backoff reconnection
- **shadcn/ui Integration:** Properly configured with dark mode theming via CSS variables

**Test Suite Health:**

- 86 tests passing across 7 test files
- Comprehensive hook testing (WebSocket, filters, history, clipboard)
- Component tests for EventDetailPanel, PacketInspector, JsonViewer

### Refactoring Performed

No refactoring performed - implementation is clean and follows established patterns.

### Compliance Check

- Coding Standards: ✓ TypeScript strict mode, proper naming conventions, no lint errors
- Project Structure: ✓ Files organized per story specification (components/, hooks/, lib/)
- Testing Strategy: ✓ Vitest used appropriately for Vite ecosystem (deviation documented)
- All ACs Met: ✓ All 7 acceptance criteria verified and tested

### Improvements Checklist

- [x] All core components implemented per specification
- [x] WebSocket hook with auto-reconnect and exponential backoff (5 tests)
- [x] Dark mode theme configured as default via CSS variables
- [x] Build produces static bundle in correct location (136KB gzipped)
- [x] Connector build integration working via build:ui script
- [x] Virtual scrolling for large event lists (@tanstack/react-virtual)
- [x] Unit tests passing (86/86)
- [ ] Consider extracting event status logic to shared utility (future enhancement)

### Security Review

- **WebSocket URL construction:** Uses same-origin pattern with protocol detection - PASS
- **No credential handling:** UI only reads/displays telemetry events - PASS
- **XSS considerations:** React's JSX escapes event data by default - PASS
- **Input validation:** Filter inputs are sanitized before use - PASS

### Performance Considerations

- **Event limiting:** maxEvents=1000 prevents unbounded memory growth - PASS
- **Virtual scrolling:** @tanstack/react-virtual for efficient large list rendering - PASS
- **Memoization:** EventRow component wrapped in React.memo - PASS
- **Build size:** 136KB gzipped JS bundle - acceptable for dashboard app

### Files Modified During Review

None - no modifications required.

### Gate Status

Gate: PASS → docs/qa/gates/14.3-explorer-ui-foundation.yml

### Recommended Status

✓ Ready for Done

All 7 acceptance criteria verified and tested. Implementation is production-ready with excellent code quality and comprehensive test coverage
