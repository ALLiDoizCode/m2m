<!-- Powered by BMAD™ Core -->

# Story 11.7: Dashboard Agent Wallet Visualization

## Status

Deferred - Dashboard Removed from Project

## Story

**As a** platform operator,
**I want** to visualize all agent wallets in the dashboard with balances and activity,
**so that** I can monitor the financial health of the agent ecosystem.

## Acceptance Criteria

1. `AGENT_WALLET_CREATED` telemetry event added to shared types
2. `AGENT_WALLET_STATE_CHANGED` telemetry event for lifecycle transitions
3. `AGENT_BALANCE_CHANGED` telemetry event for balance updates
4. Dashboard backend stores agent wallet state and balances
5. Dashboard frontend displays "Agent Wallets" panel with list of all agents
6. Agent wallet panel shows: agent ID, EVM address, XRP address, balances, state, last activity
7. Dashboard includes agent wallet details view: full balance breakdown, transaction history, channels
8. Dashboard visualizes agent activity timeline: funding, transactions, channel operations
9. Dashboard includes search/filter: by agent ID, state, balance range
10. Integration test verifies agent wallet telemetry flows to dashboard UI

## Deferral Rationale

**Decision Date:** 2026-01-21

**Reason:** The dashboard component (`packages/dashboard`) has been removed from the M2M project scope as documented in `DASHBOARD-DEFERRED.md` at the project root.

**Key Points:**

1. **Dashboard Package Removed:** The entire `packages/dashboard` directory (React + TypeScript + Vite + shadcn/ui) has been removed from the monorepo
2. **Telemetry Consumer Removed:** The dashboard WebSocket telemetry server has been removed - there is no visualization consumer for telemetry events
3. **Project Focus:** The M2M project is now focused exclusively on core ILP connector infrastructure, BTP protocol, settlement engines, and agent wallet functionality (backend only)
4. **Telemetry Emission Preserved:** All telemetry events are still emitted by the connector (including agent wallet events), but there is no UI to consume them

**What Still Works:**

- ✅ Agent wallet infrastructure (Stories 11.1-11.6) - fully functional
- ✅ Telemetry event emission system - operational in connector
- ✅ All wallet telemetry events defined in `packages/shared/src/types/telemetry.ts`
- ✅ Agent channels, lifecycle management, balance tracking - all working
- ❌ Dashboard UI visualization - removed
- ❌ WebSocket telemetry server - removed

**Future Path:**

If agent wallet visualization is needed in the future:

1. Build separate visualization project that consumes telemetry via WebSocket or HTTP API
2. Use existing telemetry event types from `packages/shared/src/types/telemetry.ts`
3. Leverage Grafana + Prometheus for metrics visualization as alternative to custom React dashboard
4. Keep dashboard development independent from core M2M connector development

**Reference Documentation:**

- `DASHBOARD-DEFERRED.md` - Complete dashboard removal rationale
- `docs/architecture/tech-stack.md` - Updated to remove dashboard references
- `docs/qa/gates/archived/dashboard/` - Archived dashboard QA gates

## Tasks / Subtasks

**All tasks deferred** - Story cannot be implemented without dashboard package.

Original planned tasks (for reference):

- [ ] Task 1: Add telemetry event types (AC: 1-3)
  - Deferred: Events exist but no consumer
- [ ] Task 2: Implement dashboard backend storage (AC: 4)
  - Deferred: No dashboard backend exists
- [ ] Task 3: Build agent wallets panel UI (AC: 5-6)
  - Deferred: No dashboard frontend exists
- [ ] Task 4: Build agent wallet details view (AC: 7)
  - Deferred: No dashboard frontend exists
- [ ] Task 5: Build agent activity timeline visualization (AC: 8)
  - Deferred: No dashboard frontend exists
- [ ] Task 6: Implement search/filter functionality (AC: 9)
  - Deferred: No dashboard frontend exists
- [ ] Task 7: Create integration test (AC: 10)
  - Deferred: No dashboard to test

## Dev Notes

### Epic 11 Context

This is **Story 11.7 in Epic 11: AI Agent Wallet Infrastructure**. Epic 11 delivers comprehensive wallet infrastructure for AI agents to participate in the M2M economy.

**Epic 11 Story Status:**

- Story 11.1 (complete): HD Wallet Master Seed Management ✅
- Story 11.2 (complete): Agent Wallet Derivation and Address Generation ✅
- Story 11.3 (complete): Agent Wallet Balance Tracking and Monitoring ✅
- Story 11.4 (complete): Automated Agent Wallet Funding ✅
- Story 11.5 (complete): Agent Wallet Lifecycle Management ✅
- Story 11.6 (complete): Payment Channel Integration for Agent Wallets ✅
- **Story 11.7 (deferred): Dashboard Agent Wallet Visualization** ⏸️
- Story 11.8: Wallet Backup and Recovery Procedures (next)
- Story 11.9: Security Hardening for Agent Wallets
- Story 11.10: Documentation and Agent Onboarding

**Impact on Epic 11:**

Story 11.7 deferral does NOT impact other Epic 11 stories. All backend wallet functionality (Stories 11.1-11.6, 11.8-11.10) remains fully functional. This story was the only Epic 11 story requiring dashboard/UI components.

### Telemetry Events Already Implemented

The following telemetry event types are ALREADY defined and emitted by the connector (from previous stories):

**From Story 11.5 (Agent Wallet Lifecycle):**

- `AGENT_WALLET_STATE_CHANGED` - Already implemented [Source: packages/shared/src/types/telemetry.ts]

**From Story 11.6 (Payment Channel Integration):**

- `AGENT_CHANNEL_OPENED` - Already implemented
- `AGENT_CHANNEL_PAYMENT_SENT` - Already implemented
- `AGENT_CHANNEL_CLOSED` - Already implemented

**Missing Events (AC 1-3):**

- `AGENT_WALLET_CREATED` - Not yet implemented (AC 1)
- `AGENT_BALANCE_CHANGED` - Not yet implemented (AC 3)

**Note:** If telemetry-only implementation is desired (no dashboard), Stories 11.2, 11.3, and 11.4 could be updated to emit `AGENT_WALLET_CREATED` and `AGENT_BALANCE_CHANGED` events. However, without a consumer, these events would only be logged, not visualized.

### Alternative Visualization Options

**Option 1: Structured Logging**

- Connector already uses Pino structured JSON logging
- All telemetry events are logged to stdout
- Use log aggregation tools (ELK stack, Loki, CloudWatch) to query and visualize agent wallet events

**Option 2: Prometheus + Grafana**

- Expose Prometheus metrics endpoint in connector
- Track agent wallet counts, balances, channel counts as metrics
- Visualize in Grafana dashboards
- No React/frontend development required

**Option 3: Future Standalone Dashboard**

- Build separate visualization project (outside M2M monorepo)
- Consume telemetry via WebSocket or REST API from connector
- Independent development lifecycle from core connector
- See `DASHBOARD-DEFERRED.md` for migration path

### File Locations (If Dashboard Existed)

**Deferred Files (would have been created):**

- `packages/dashboard/src/components/agent-wallets/AgentWalletsPanel.tsx` - Agent wallets list panel
- `packages/dashboard/src/components/agent-wallets/AgentWalletDetails.tsx` - Wallet details view
- `packages/dashboard/src/components/agent-wallets/ActivityTimeline.tsx` - Activity visualization
- `packages/dashboard/src/stores/agentWalletStore.ts` - Client-side state management
- `packages/dashboard/backend/src/stores/agent-wallet-store.ts` - Backend telemetry storage
- `packages/dashboard/backend/src/stores/agent-wallet-store.test.ts` - Backend tests

**None of these files exist** - dashboard package removed.

### Testing Requirements

**Deferred** - No tests can be written without dashboard package.

**If dashboard is restored in future:**

- Unit tests for React components (Jest + React Testing Library)
- Integration tests for WebSocket telemetry flow (connector → dashboard)
- E2E tests for agent wallet visualization (Playwright)
- All tests should use shadcn-ui components per project standards (CLAUDE.md)

## Change Log

| Date       | Version | Description                                            | Author |
| ---------- | ------- | ------------------------------------------------------ | ------ |
| 2026-01-21 | 1.0     | Story created in "Deferred" status - dashboard removed | Claude |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929) - Story Documentation

### File List

**Files created during Story 11.7:**

- `docs/stories/11.7.story.md` - This story file (documenting deferral)

**No implementation files created** - story deferred due to dashboard removal.

### Completion Notes

**Story Status:** Deferred - Dashboard Removed from Project Scope

**Summary:**

Story 11.7 has been formally deferred because the dashboard package (`packages/dashboard`) was removed from the M2M project as documented in `DASHBOARD-DEFERRED.md`. All 10 acceptance criteria require dashboard UI components that no longer exist in the project.

**Key Points:**

1. **Dashboard Removed:** React + TypeScript + Vite dashboard package completely removed from monorepo
2. **Backend Functional:** All agent wallet backend functionality (Stories 11.1-11.6) remains fully operational
3. **Telemetry Operational:** Connector still emits all telemetry events (no consumer for visualization)
4. **No Blockers:** Story 11.7 deferral does NOT block Epic 11 Stories 11.8-11.10 (all backend-focused)

**Alternative Monitoring:**

- Structured JSON logging (Pino) - query logs for agent wallet events
- Prometheus + Grafana - metrics-based visualization
- Future standalone dashboard - independent project consuming telemetry API

**Next Steps:**

Proceed to **Story 11.8: Wallet Backup and Recovery Procedures** (backend-focused, no dashboard dependency).

### Debug Log

**2026-01-21:** Story created during `/BMad:tasks:create-next-story 11.7` execution. Dashboard removal discovered during architecture document review. User selected Option 1: "Skip Story 11.7 entirely" due to fundamental incompatibility with current project architecture.

**Decision:** Story 11.7 remains in Epic 11 documentation as "Deferred" to maintain story sequence and provide clear rationale for future developers.

## QA Results

**QA Status:** Not Applicable - Story Deferred

**Rationale:** No implementation to review. Story documented for historical record and future reference.

---

**Story Owner:** Product Owner should decide whether to:

1. Keep story as "Deferred" indefinitely
2. Remove story from Epic 11 entirely
3. Redefine story as telemetry-only (no UI visualization)
4. Move story to future dashboard project backlog
