# Data Models

## ILPPacket (Base)

**Purpose:** Abstract base type for all ILP packet types (Prepare, Fulfill, Reject) as defined in RFC-0027

**Key Attributes:**
- `type: PacketType` (enum: PREPARE = 12, FULFILL = 13, REJECT = 14) - Discriminator for packet type
- `data: Buffer` - Binary payload data
- `amount: bigint` - Payment amount in smallest unit (uint64)
- `destination: ILPAddress` - Hierarchical ILP address per RFC-0015

**Relationships:**
- Extended by ILPPreparePacket, ILPFulfillPacket, ILPRejectPacket
- Used in BTPMessage payload field

## ILPPreparePacket

**Purpose:** Represents conditional payment packet initiating an ILP transaction (RFC-0027 Section 3.1)

**Key Attributes:**
- `type: PacketType.PREPARE` (12) - Packet type identifier
- `amount: bigint` - Transfer amount
- `destination: ILPAddress` - Payment destination address
- `executionCondition: Buffer` - 32-byte SHA-256 hash condition
- `expiresAt: Date` - Expiration timestamp (ISO 8601)
- `data: Buffer` - Optional application data payload

**Relationships:**
- Forwarded through multiple Connectors until reaching destination
- Responded to with either ILPFulfillPacket or ILPRejectPacket
- Wrapped in BTPMessage for transmission

## ILPFulfillPacket

**Purpose:** Represents successful payment fulfillment (RFC-0027 Section 3.2)

**Key Attributes:**
- `type: PacketType.FULFILL` (13) - Packet type identifier
- `fulfillment: Buffer` - 32-byte preimage that hashes to executionCondition
- `data: Buffer` - Optional return data

**Relationships:**
- Response to ILPPreparePacket
- Propagates backward through connector chain

## ILPRejectPacket

**Purpose:** Represents payment rejection with error information (RFC-0027 Section 3.3)

**Key Attributes:**
- `type: PacketType.REJECT` (14) - Packet type identifier
- `code: ILPErrorCode` - Three-character error code (F00-F99, T00-T99, R00-R99)
- `triggeredBy: ILPAddress` - Address of connector that generated error
- `message: string` - Human-readable error description
- `data: Buffer` - Additional error context

**Relationships:**
- Response to ILPPreparePacket when payment cannot be fulfilled
- Propagates backward through connector chain

**Error Code Categories:**
- F-prefix: Final errors (permanent failures)
- T-prefix: Temporary errors (retryable)
- R-prefix: Relative errors (protocol violations)

## RoutingTableEntry

**Purpose:** Maps ILP address prefixes to next-hop peer identifiers for packet forwarding

**Key Attributes:**
- `prefix: string` - ILP address prefix (e.g., "g.alice" or "g.bob.crypto")
- `nextHop: string` - Peer identifier matching BTP connection
- `priority: number` - Route priority for tie-breaking (optional, default 0)

**Relationships:**
- Many entries comprise a RoutingTable
- nextHop references a Peer in the connector's peer list

## Peer

**Purpose:** Represents a BTP-connected peer connector with connection metadata

**Key Attributes:**
- `id: string` - Unique peer identifier
- `url: string` - WebSocket URL for BTP connection (e.g., "ws://connector-b:3000")
- `authToken: string` - Shared secret for BTP authentication
- `connected: boolean` - Current connection state
- `lastSeen: Date` - Timestamp of last successful communication

**Relationships:**
- Referenced by RoutingTableEntry.nextHop
- Manages one BTPConnection instance

## BTPMessage

**Purpose:** BTP protocol message wrapping ILP packets for transmission (RFC-0023)

**Key Attributes:**
- `type: BTPMessageType` (enum: MESSAGE, RESPONSE, ERROR, TRANSFER, etc.)
- `requestId: number` - Correlation ID for request/response matching
- `data: BTPData` - Message payload containing:
  - `protocolData: BTPProtocolData[]` - Array of protocol-specific data
  - `ilpPacket: Buffer` - Serialized ILP packet (OER encoded)

**Relationships:**
- Contains serialized ILPPacket
- Transmitted over WebSocket connection between Peers

## TelemetryEvent

**Purpose:** Observability event emitted by connectors to dashboard for visualization

**Key Attributes:**
- `type: TelemetryEventType` (enum: NODE_STATUS, PACKET_RECEIVED, PACKET_SENT, ROUTE_LOOKUP)
- `nodeId: string` - Identifier of connector emitting event
- `timestamp: Date` - Event occurrence time
- `data: object` - Event-specific payload (varies by type)

**Event Type Payloads:**
- `NODE_STATUS`: { routes: RoutingTableEntry[], peers: Peer[], health: string }
- `PACKET_RECEIVED`: { packetId: string, type: PacketType, source: string, destination: string, amount: string }
- `PACKET_SENT`: { packetId: string, nextHop: string, timestamp: string }
- `ROUTE_LOOKUP`: { destination: string, selectedPeer: string, reason: string }

**Relationships:**
- Generated by Connector components during packet processing
- Transmitted to Dashboard via WebSocket
- Consumed by Dashboard for visualization and logging

## ConnectorConfig

**Purpose:** Configuration object loaded at connector startup defining routing and peer topology

**Key Attributes:**
- `nodeId: string` - Unique identifier for this connector instance
- `btpServerPort: number` - Port for incoming BTP connections (default 3000)
- `healthCheckPort: number` - HTTP health endpoint port (default 8080)
- `peers: Peer[]` - List of peer connectors to connect to
- `routes: RoutingTableEntry[]` - Initial routing table entries
- `logLevel: string` - Logging verbosity (DEBUG, INFO, WARN, ERROR)
- `dashboardTelemetryUrl: string` - WebSocket URL for telemetry emission

**Relationships:**
- Loaded from YAML file or environment variables
- Initializes RoutingTable and Peer connections
