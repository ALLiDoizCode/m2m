# Docker Compose configuration for 3-node linear ILP network
# Topology: Linear chain - A → B → C
#
#     Connector A (Port 3000)
#         ↓
#     Connector B (Port 3001)
#         ↓
#     Connector C (Port 3002)
#
# Connections:
#   - A connects to B (A initiates)
#   - B connects to C (B initiates)
#   - Traffic from A to C routes through B
#
# Explorer UI Access:
#   - Connector A: http://localhost:3010
#   - Connector B: http://localhost:3011
#   - Connector C: http://localhost:3012
#
# Usage:
#   Start: docker-compose -f docker/docker-compose.linear.yml up -d
#   Logs:  docker-compose -f docker/docker-compose.linear.yml logs -f
#   Stop:  docker-compose -f docker/docker-compose.linear.yml down
#
# Prerequisites:
#   Build the connector image: docker build -t ilp-connector .
#
# Configuration:
#   Each connector loads its configuration from a YAML file mounted as a volume.
#   Configuration files: examples/linear-3-nodes-{a,b,c}.yaml
#   This topology demonstrates simple packet forwarding through an intermediary.

version: '3.8'

services:
  # Connector A - First node in linear chain
  # Explorer UI: http://localhost:3010
  connector-a:
    image: ilp-connector
    container_name: connector-a
    environment:
      CONFIG_FILE: /app/config.yaml
      NODE_ID: connector-a
      LOG_LEVEL: info
      DASHBOARD_TELEMETRY_URL: ws://localhost:9999
      EXPLORER_ENABLED: "true"
      EXPLORER_PORT: "3010"
    volumes:
      - ../examples/linear-3-nodes-a.yaml:/app/config.yaml:ro
    ports:
      - "3000:3000"
      - "3010:3010"
    networks:
      - ilp-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Connector B - Middle node in linear chain
  # Explorer UI: http://localhost:3011
  connector-b:
    image: ilp-connector
    container_name: connector-b
    environment:
      CONFIG_FILE: /app/config.yaml
      NODE_ID: connector-b
      LOG_LEVEL: info
      DASHBOARD_TELEMETRY_URL: ws://localhost:9999
      EXPLORER_ENABLED: "true"
      EXPLORER_PORT: "3011"
    volumes:
      - ../examples/linear-3-nodes-b.yaml:/app/config.yaml:ro
    ports:
      - "3001:3001"
      - "3011:3011"
    networks:
      - ilp-network
    depends_on:
      - connector-a
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Connector C - Last node in linear chain
  # Explorer UI: http://localhost:3012
  connector-c:
    image: ilp-connector
    container_name: connector-c
    environment:
      CONFIG_FILE: /app/config.yaml
      NODE_ID: connector-c
      LOG_LEVEL: info
      DASHBOARD_TELEMETRY_URL: ws://localhost:9999
      EXPLORER_ENABLED: "true"
      EXPLORER_PORT: "3012"
    volumes:
      - ../examples/linear-3-nodes-c.yaml:/app/config.yaml:ro
    ports:
      - "3002:3002"
      - "3012:3012"
    networks:
      - ilp-network
    depends_on:
      - connector-a
      - connector-b
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  ilp-network:
    driver: bridge
